Anatel - Consulta e Processamento do Banco de Dados
================

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

<a href="https://gitmoji.dev">
<img src="https://img.shields.io/badge/gitmoji-%20üòú%20üòç-FFDD67.svg?style=flat-square" alt="Gitmoji">
</a>

## Instala√ß√£o

<code>pip install git+https://github.com/ronaldokun/anateldb.git</code>

## Como utilizar

### Consulta √† base de dados formatada para o AppAnalise de Anatel

A motiva√ß√£o original para a presente biblioteca foi disponibilizar os
dados de diferentes fontes da Anatel - e posteriormente da Aeron√°utica -
programaticamente, para serem utilizadas pelo
[AppAnalise](https://github.com/EricMagalhaesDelgado/appAnalise/releases/)
na identifica√ß√£o de emiss√µes captadas pelos planos de monitora√ß√£o e
tamb√©m em fiscaliza√ß√£o de campo.

Os dados em formato otimizado `.parquet.gzip` s√£o disponibilizados junto
ao reposit√≥rio na pasta `dados`.

``` python
from fastcore.xtras import Path
from extracao.main import get_db
from nbdev.showdoc import *
```

------------------------------------------------------------------------

<a
href="https://github.com/ronaldokun/anateldb/blob/master/extracao/main.py#LNone"
target="_blank" style="float:right; font-size:smaller">source</a>

### get_db

>      get_db (path:Union[str,pathlib.Path], connSQL:pyodbc.Connection=None,
>              clientMongoDB:pymongo.mongo_client.MongoClient=None)

L√™ e opcionalmente atualiza as bases da Anatel, mescla as bases da
Aeron√°utica, salva e retorna o arquivo A atualiza√ß√£o junto √†s bases de
dados da Anatel √© efetuada caso ambos objetos de banco `connSQL` e
`clientMongoDB` forem v√°lidos\`

|               | **Type**      | **Default** | **Details**                                                     |
|---------------|---------------|-------------|-----------------------------------------------------------------|
| path          | Union         |             | Pasta onde salvar os arquivos‚Äù,                                 |
| connSQL       | Connection    | None        | Objeto de conex√£o do banco SQL Server                           |
| clientMongoDB | MongoClient   | None        | Objeto de conex√£o do banco MongoDB                              |
| **Returns**   | **DataFrame** |             | **Retorna o DataFrame com as bases da Anatel e da Aeron√°utica** |

``` python
db = get_db(pasta)
db.sample(5)
```

<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">üìú<span style="color: #008000; text-decoration-color: #008000">Lendo as bases de dados da Anatel...</span>
</pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Id</th>
      <th>Frequency</th>
      <th>Latitude</th>
      <th>Longitude</th>
      <th>Description</th>
      <th>Service</th>
      <th>Station</th>
      <th>Class</th>
      <th>BW</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>667035</th>
      <td>#667036</td>
      <td>527.00000</td>
      <td>-2.806110</td>
      <td>-57.069721</td>
      <td>[MOS] TV-C1, C, Camara Dos Deputados (50441490...</td>
      <td>801</td>
      <td>-1</td>
      <td>NI</td>
      <td>5700.0</td>
    </tr>
    <tr>
      <th>107525</th>
      <td>#107526</td>
      <td>156.47500</td>
      <td>-8.581717</td>
      <td>-63.725052</td>
      <td>[STEL] L, ML, Transportes Bertolini Ltda (1202...</td>
      <td>19</td>
      <td>1000751993</td>
      <td>G3E</td>
      <td>16.0</td>
    </tr>
    <tr>
      <th>117314</th>
      <td>#117315</td>
      <td>156.70000</td>
      <td>-1.540750</td>
      <td>-48.743168</td>
      <td>[STEL] L, FC, Alpina Briggs Defesa Ambiental S...</td>
      <td>19</td>
      <td>690246978</td>
      <td>F3E</td>
      <td>16.0</td>
    </tr>
    <tr>
      <th>273145</th>
      <td>#273146</td>
      <td>167.63125</td>
      <td>-20.387291</td>
      <td>-44.484554</td>
      <td>[STEL] L, ML, Policia Militar Do Estado De Min...</td>
      <td>19</td>
      <td>1001948332</td>
      <td>F1W</td>
      <td>8.1</td>
    </tr>
    <tr>
      <th>306394</th>
      <td>#306395</td>
      <td>167.74375</td>
      <td>-19.881208</td>
      <td>-43.859077</td>
      <td>[STEL] L, ML, Policia Militar Do Estado De Min...</td>
      <td>19</td>
      <td>1002234406</td>
      <td>G1W</td>
      <td>8.1</td>
    </tr>
  </tbody>
</table>
</div>

### M√©todos para atualizar os arquivos das bases de dados

``` python
from extracao.updates import update_mosaico, update_radcom, update_stel, update_telecom, update_base
```

A fun√ß√£o `update_mosaico` atualiza os dados de radiodifus√£o p√∫blica
dispon√≠veis na interface p√∫blica online do [Spectrum
E](http://sistemas.anatel.gov.br/se/public/view/b/srd.php)

``` python
%%time
update_mosaico(pasta='D:\OneDrive - ANATEL\GR01FI3\BaseDados')
```

    Baixando as Esta√ß√µes do Mosaico...
    Baixando o Plano B√°sico das Esta√ß√µes...
    Baixando o Hist√≥rico de Atualiza√ß√µes...
    Kb√¥
    Wall time: 8.12 s

A fun√ß√£o
[`update_radcom`](https://ronaldokun.github.io/updates.html#update_radcom)
√© um complemento √† fun√ß√£o `update_mosaico`. Ela retorna os registros
espec√≠ficos de R√°dio Comunit√°ria, os quais ficam em base separada.

``` python
%%time
update_radcom('D:\OneDrive - ANATEL\GR01FI3\BaseDados')
```

    Lendo o Banco de Dados de Radcom
    Wall time: 1 s

A fun√ß√£o <code>update_telecom</code> √© bem mais lenta que as demais,
dado que o banco de dados abarca todos os registros privados de servi√ßos
de telecomunica√ß√µes da ANATEL, com cerca de **10.000.000** registros
ativos atualmente. Esse banco de dados √© atualizado 1 vez ao dia √†
meia-noite e remete ao estado do dia anterior, portanto n√£o faz sentido
atualiz√°-lo mais de 1 vez por dia.

A fun√ß√£o
[`update_stel`](https://ronaldokun.github.io/updates.html#update_stel)
retorna os registros de Servi√ßos Privados de Telecomunica√ß√µes da Anatel
que ainda n√£o constam na base p√∫blica do Mosaico em [Spectrum -
E](http://sistemas.anatel.gov.br/se/public/view/b/licenciamento.php) e
s√£o retornados pela fun√ß√£o
[`update_telecom`](https://ronaldokun.github.io/updates.html#update_telecom)

``` python
%%time
update_stel('D:\OneDrive - ANATEL\GR01FI3\BaseDados')
```

A fun√ß√£o
[`update_base`](https://ronaldokun.github.io/updates.html#update_base)
combina as 4 bases anteriores e uniformiza os campos:

``` python
update_base('D:\OneDrive - ANATEL\GR01FI3\BaseDados')
```

### M√©todos para ler as Bases de Dados

``` python
from extracao.reading import read_radcom, read_stel, read_mosaico, read_telecom, read_base
radcom = read_radcom(pasta)
radcom.sample(5).iloc[:,:5]
```

Se o argumento <code>conn</code> for fornecido, o arquivo ser√°
atualizado por meio da fun√ß√£o <code>update_radcom</code>.

> *A fun√ß√£o <code>update_radcom</code> somente ir√° funcionar caso o PC
> estiver plugado na rede interna cabeada da Anatel.*

``` python
stel = read_stel(pasta)
stel.sample(5).iloc[:,:7]
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Frequ√™ncia</th>
      <th>Classe_Emiss√£o</th>
      <th>Largura_Emiss√£o</th>
      <th>Classe</th>
      <th>Num_Servi√ßo</th>
      <th>Entidade</th>
      <th>Fistel</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>713502</th>
      <td>459.68750</td>
      <td>F1D</td>
      <td>7K60</td>
      <td>FX</td>
      <td>019</td>
      <td>MOSAIC FERTILIZANTES P&amp;K LTDA.</td>
      <td>50416997473</td>
    </tr>
    <tr>
      <th>744967</th>
      <td>469.70000</td>
      <td>F1W</td>
      <td>7K60</td>
      <td>BR</td>
      <td>019</td>
      <td>ASSOCIACAO MELHORAMENTOS PARQUE SILVINO PEREIRA</td>
      <td>50011329165</td>
    </tr>
    <tr>
      <th>353408</th>
      <td>167.34375</td>
      <td>F1W</td>
      <td>7K60</td>
      <td>FB</td>
      <td>019</td>
      <td>DURATEX FLORESTAL LTDA</td>
      <td>02021684504</td>
    </tr>
    <tr>
      <th>226524</th>
      <td>157.78125</td>
      <td>F1E</td>
      <td>7K60</td>
      <td>FX</td>
      <td>011</td>
      <td>OLIVEIRA, TAVORA E CIA LTDA</td>
      <td>50418317186</td>
    </tr>
    <tr>
      <th>380431</th>
      <td>167.68125</td>
      <td>F3E</td>
      <td>11K0</td>
      <td>ML</td>
      <td>019</td>
      <td>POLICIA MILITAR DO ESTADO DE MINAS GERAIS</td>
      <td>50401288943</td>
    </tr>
  </tbody>
</table>
</div>

Se o argumento <code>conn</code> for fornecido, o arquivo ser√°
atualizado por meio da fun√ß√£o <code>update_stel</code>.

> *A fun√ß√£o <code>update_stel</code> somente ir√° funcionar caso o PC
> estiver plugado na rede interna cabeada da Anatel.*

``` python
mosaico = read_mosaico(pasta)
mosaico.sample(5).iloc[:,:7]
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Num_Servi√ßo</th>
      <th>Id</th>
      <th>N√∫mero_Esta√ß√£o</th>
      <th>Latitude</th>
      <th>Longitude</th>
      <th>Validade_RF</th>
      <th>Munic√≠pio</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>14017</th>
      <td>800</td>
      <td>57dbabf18de3d</td>
      <td>1002434758</td>
      <td>-21.762528</td>
      <td>-43.357556</td>
      <td>2023-12-31</td>
      <td>Juiz de Fora</td>
    </tr>
    <tr>
      <th>28419</th>
      <td>801</td>
      <td>617afd492ade4</td>
      <td>&lt;NA&gt;</td>
      <td>-17.400000</td>
      <td>-42.717220</td>
      <td>2041-11-18</td>
      <td>Veredinha</td>
    </tr>
    <tr>
      <th>216</th>
      <td>800</td>
      <td>57dbaadbc8413</td>
      <td>441611648</td>
      <td>-7.730833</td>
      <td>-72.648889</td>
      <td>2023-12-31</td>
      <td>Rodrigues Alves</td>
    </tr>
    <tr>
      <th>15976</th>
      <td>230</td>
      <td>57dbac17c5a24</td>
      <td>699381339</td>
      <td>-19.817611</td>
      <td>-40.336056</td>
      <td>2024-08-20</td>
      <td>Ibira√ßu</td>
    </tr>
    <tr>
      <th>10352</th>
      <td>801</td>
      <td>57dbabb50b92a</td>
      <td>&lt;NA&gt;</td>
      <td>-21.208611</td>
      <td>-45.198056</td>
      <td>2035-10-09</td>
      <td>Nepomuceno</td>
    </tr>
  </tbody>
</table>
</div>

Se o argumento <code>mongo_client</code> for fornecido, o arquivo ser√°
atualizado por meio da fun√ß√£o <code>update_mosaico</code>. \> *A fun√ß√£o
<code>update_mosaico</code> somente ir√° funcionar caso o PC estiver
plugado na rede interna cabeada da Anatel.*

``` python
telecom = read_telecom(pasta)
telecom.sample(5).iloc[:,:7]
```

Se o argumento <code>mongo_client</code> for fornecido, o arquivo ser√°
atualizado por meio da fun√ß√£o <code>update_telecom</code>. \> *A fun√ß√£o
<code>update_telecom</code> somente ir√° funcionar caso o PC estiver
plugado na rede interna cabeada da Anatel.*

``` python
base = read_base(pasta)
base.sample(5).iloc[:, :7]
```

A fun√ß√£o
[`read_base`](https://ronaldokun.github.io/reading.html#read_base)
combina os 4 arquivos anteriores, e mescla os registros similares dos
arquivos consolidados da aeron√°utica. Se os argumentos <code>conn e
mongo_client</code> forem fornecidos, os arquivo ser√£o atualizados por
meio de chamada da fun√ß√£o
[`update_base`](https://ronaldokun.github.io/updates.html#update_base),
esta fun√ß√£o encapsula a atualiza√ß√£o de todos os arquivos por meio das
fun√ß√µes de atualiza√ß√£o mencionadas anteriormente. \> *A fun√ß√£o
<code>update_base</code> somente ir√° funcionar caso o PC estiver plugado
na rede interna cabeada da Anatel.*
